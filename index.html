<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> 
<script src="js/SPARQLWrapper.js" type="text/javascript"></script>
<script src="js/jquery.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="css/magic-check.css">
<link rel="stylesheet" type="text/css" href="css/loading.css">
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style type="text/css">
	#main{
		margin-top: 150px;
	}
	img {
	    width: 100%;
	    height: 100%;
	}
	.opt{height:30px;line-height:24px;float: left;}
	.opt:not(:first-child){
		margin-left: 15px
	}
   	.mydiv{
   		float: left;
   		text-align: center;
   		margin-top: 40px;
   	}
   	#none{
   		text-align: center;
   		margin-top: 40px;
   		font-size: 20px;
   	}
</style>
</head>

<body>
	<div>
		<div><img src="image/banner.jpg"></div>
		<div class="row">
		  <div class="col-md-4 col-md-offset-4">
		    <div class="input-group">
		      <input type="text" placeholder="仅支持英文输入 例如：Harry Potter" class="form-control" id="searchValue" aria-label="...">
		      <div class="input-group-btn">
		        <button type="button" class="btn btn-primary dropdown-toggle" onclick="search()">搜索</button>
		      </div><!-- /btn-group -->
		    </div><!-- /input-group -->
		    <div style="margin-top: 10px">
		    	<div class="opt">
					<input class="magic-checkbox" type="radio" name="layout" value="Film" id="c1" checked="">
					<label for="c1">电影</label>
				</div>
				<div class="opt">
					<input class="magic-checkbox" type="radio" name="layout" value="Book" id="c2">
					<label for="c2">书籍</label>
				</div>
				<div class="opt">
					<input class="magic-checkbox" type="radio" name="layout" value="Game" id="c3">
					<label for="c3">游戏</label>
				</div> 
				<div class="opt">
					<input class="magic-checkbox" type="radio" name="layout" value="ALL" id="c4">
					<label for="c4">不限</label>
				</div> 
		    </div>
		  </div><!-- /.col-lg-6 -->
		</div><!-- /.row -->

		<div class="row">
			<div id="loading" class="col-md-4 col-md-offset-4 hidden">
				<div class="spinner">
				  <div class="rect1"></div>
				  <div class="rect2"></div>
				  <div class="rect3"></div>
				  <div class="rect4"></div>
				  <div class="rect5"></div>
				</div>
			</div>
			<div id="none" class="col-md-4 col-md-offset-4 hidden"><p>无结果</p></div>
			<div id="result" class="row hidden">
				<div class="col-md-4 col-md-offset-1  mydiv">
					<div id="list"></div>
					<button type="button" id="previous" class="btn btn-primary hidden" onclick="previous()">上一页</button>
					<button type="button" id="next" class="btn btn-primary hidden" onclick="next()">下一页</button>
				</div>
				<div id="bing" class="col-md-5 col-md-offset-1  mydiv">
					<div id="container" style="height:500px">
						
					</div>
				</div>
			</div>
			
		</div>
	</div>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
<script>
var totalPage = 0;
var currentPage = 1;
var mainArr = [];
var sparql = new SPARQLWrapper("http://dbpedia.org/sparql");
var game = []
var book = []
var film = []


function search(){
	currentPage = 1;
	$("#none").addClass("hidden");
	$("#result").addClass("hidden");

	var searchValue = $("#searchValue").val();
	if(searchValue == ""||searchValue==null){
		alert("请输入搜索内容")
		return;
	}
	$("#loading").removeClass("hidden");
	var type = $("input[name='layout']:checked").val();
	var value = "'"+searchValue+"'";
	var sql = "select distinct ?result ?name where { ?result rdf:type dbo:"+type+"; rdfs:label ?name. filter regex(?name, "+value+")}"
	if(type!='ALL'){
		sparql.setQuery(sql)
		sparql.query(function(json){
			var temp = JSON.parse(json).results.bindings;
			if(type == "Film"){
				film = temp;
			}else if(type == "Book"){
				book = temp
			}else{
				game = temp;
			}
			show(JSON.parse(json).results.bindings,[],[])

		});
	}else{
		type = "Film"
		sql = "select distinct ?result ?name where { ?result rdf:type dbo:"+type+"; rdfs:label ?name. filter regex(?name, "+value+")}"
		sparql.setQuery(sql)
		sparql.query(function(json){
			film = JSON.parse(json).results.bindings;
			type = "Game"
			sql = "select distinct ?result ?name where { ?result rdf:type dbo:"+type+"; rdfs:label ?name. filter regex(?name, "+value+")}"
			sparql.setQuery(sql)
			sparql.query(function(json){
				game = JSON.parse(json).results.bindings;
				type = "Book"
				sql = "select distinct ?result ?name where { ?result rdf:type dbo:"+type+"; rdfs:label ?name. filter regex(?name, "+value+")}"
				sparql.setQuery(sql)
				sparql.query(function(json){
					book = JSON.parse(json).results.bindings;
					show(film,book,game);
				});
			});
		});
	}
}
function show(film,book,game){
	$("#loading").addClass("hidden");
	if(film.length == 0 && book.length == 0 && game.length == 0){
		$("#none").removeClass("hidden");
	}else{
		$("#result").removeClass("hidden");
		mainArr = film.concat(book,game)
		showList(1);
		showpie();
		if(mainArr.length %10 != 0){
			totalPage = parseInt(mainArr.length/10) + 1
		}else{
			totalPage = parseInt(mainArr.length/10);
		}
		if(mainArr.length > 10){
			$("#next").removeClass("hidden");
		}
	}
}
function next(){
	currentPage++;
	if(currentPage > 1){
		$("#previous").removeClass("hidden");
	}
	if(currentPage == totalPage){
		$("#next").addClass("hidden");
	}
	showList(currentPage)
}

function previous(){
	currentPage--;
	if(currentPage ==1){
		$("#previous").addClass("hidden");
	}
	if(currentPage < totalPage){
		$("#next").removeClass("hidden");
	}
	showList(currentPage)
}

function showList(page){
	$("#list").empty();
	var str = []
	for(var i = (page-1)*10; i < 10*page && i < mainArr.length; i++){
		var desc = "movie";
		if(i < film.length){

		}else if(i >= film.length && i < (film.length + book.length)){
			desc = "book"
		}else{
			desc = "game"
		}
		str = str + "<p><a href='"+mainArr[i].result.value+"'>"+"【"+desc+"】"+mainArr[i].name.value+"</a></p>"
	}
	$("#list").append(str);
}

function showpie(){
	var dom = document.getElementById("container");
	var myChart = echarts.init(dom);
	var app = {};
	option = null;

	option = {
	    title : {
	        text: '结果统计',
	        subtext: '分类统计',
	        x:'center'
	    },
	    tooltip : {
	        trigger: 'item',
	        formatter: "{a} <br/>{b} : {c} ({d}%)"
	    },
	    legend: {
	        type: 'scroll',
	        orient: 'vertical',
	        right: 10,
	        top: 20,
	        bottom: 20,
	        data: ['movie','book','game'],

	        //selected: data.selected
	    },
	    series : [
	        {
	            name: 'type',
	            type: 'pie',
	            radius : '55%',
	            center: ['40%', '50%'],
	            data: [
	            	{value:film.length,name:'movie'},
	            	{value:book.length,name:'book'},
	            	{value:game.length,name:'game'}
	            ],
	            itemStyle: {
	                emphasis: {
	                    shadowBlur: 10,
	                    shadowOffsetX: 0,
	                    shadowColor: 'rgba(0, 0, 0, 0.5)'
	                }
	            }
	        }
	    ]
	};

	if (option && typeof option === "object") {
	    myChart.setOption(option, true);
	}
}


</script>
</body> 
</html> 
